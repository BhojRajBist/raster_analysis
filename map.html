<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>H3 Visualization</title>
    <link href='https://unpkg.com/maplibre-gl@2.2.0/dist/maplibre-gl.css' rel='stylesheet' />
    <style>
        body { margin: 0; padding: 0; }
        #map { width: 100vw; height: 100vh; }
    </style>
</head>
<body>
    <div id='map'></div>
    <script src='https://unpkg.com/maplibre-gl@2.2.0/dist/maplibre-gl.js'></script>
    <script>
        // Initialize the map
        const map = new maplibregl.Map({
            container: 'map',
            style: {
                "version": 8,
                "sources": {
                    "osm": {
                        "type": "raster",
                        "tiles": [
                            "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
                        ],
                        "tileSize": 256
                    }
                },
                "layers": [
                    {
                        "id": "osm",
                        "type": "raster",
                        "source": "osm",
                        "minzoom": 0,
                        "maxzoom": 19
                    }
                ]
            },
            center: [84.1240, 28.3949], // Center on Nepal (longitude, latitude)
            zoom: 6
        });

        map.on('load', function() {
            console.log('Map loaded');

            // Fetch GeoJSON data from the FastAPI endpoint
            fetch('http://localhost:8000/visualize/class') // Replace YOUR_TABLE_NAME with the actual table name
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('GeoJSON data fetched successfully:', data);

                    // Add the GeoJSON source
                    map.addSource('h3-indexes', {
                        'type': 'geojson',
                        'data': data
                    });

                    // Add a layer to visualize the H3 indexes
                    map.addLayer({
                        'id': 'h3-index-layer',
                        'type': 'fill',
                        'source': 'h3-indexes',
                        'layout': {},
                        'paint': {
                            'fill-color': '#888888',
                            'fill-opacity': 0.4
                        }
                    });
                })
                .catch(error => console.error('Error fetching GeoJSON data:', error));
        });

        map.on('error', (e) => {
            console.error('Map error:', e.error.message);
        });
    </script>
</body>
</html>
